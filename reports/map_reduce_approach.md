---
marp: true
theme: default
paginate: true
---

# 行政文書質問応答システム
## Map-Reduce アプローチの実装

---

## 背景

### 従来RAGの課題
- **ベクトル検索の精度限界**: 関連性の高い部分を取りこぼし
- **チャンク分割の問題**: 文脈が分断される
- **複雑な参照関係**: 行政文書特有の相互参照を捉えきれない

### Mistral Nemo の優位性
- **128K context window**: A4 700ページ級文書を丸ごと投入可能
- **日本語対応**: 行政文書の専門用語・法的表現に対応
- **ローカル実行**: コスト削減とプライバシー保護

---

## アプローチ: Map-Reduce方式

```
質問 → [Doc1処理] → 回答1+出典
    → [Doc2処理] → 回答2+出典  → 統合処理 → 最終回答
    → [DocN処理] → 回答N+出典
```

### Single QA (Map Phase)
- 各文書に対して個別に質問処理
- 文書全体を理解した上で回答生成
- 出典情報の確実な追跡

### Aggregate QA (Reduce Phase)  
- 個別回答を統合して最終回答作成
- 回答の質的分類と優先順位付け

---

## Single QA の実装手法

### プロンプトテンプレート設計
```
map_reduce/prompts/single_qa/
├── baseline.txt    # シンプルな基本形
├── structured.txt  # 構造化回答形式
├── qualitative.txt # 市民相談の視点
└── strict.txt      # 厳密検証アプローチ
```

### 回答の質的分類
- **直接回答**: 明確に適用可能な制度・支援
- **間接回答**: 条件次第で適用可能
- **関連情報**: 参考となる周辺情報
- **該当無し**: 関連情報なし

### 技術実装
- **Ollama連携**: 公式ライブラリで安定通信
- **トークン監視**: 使用量・残量の可視化
- **テンプレート選択**: 実行時に柔軟な切り替え

---